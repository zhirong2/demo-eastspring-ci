name: 🚀 EastSpring Testim E2E Tests

on:
  push:
    branches:
      - master
      - main
  pull_request:

jobs:
  run-testimio-cli:
    name: Run Testim.io E2E Tests
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Checkout repository
        uses: actions/checkout@v4

      - name: ⚙️ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.17.1'
        
      - name: 📦 Install Testim CLI
        run: npm install -g @testim/testim-cli
      
      # Testim Grid runs in headless mode by default
      - name: 🧪 Run Testim tests
        env:
          TESTIM_TOKEN: ${{ secrets.TESTIM_TOKEN }}
          TESTIM_PROJECT: ${{ secrets.TESTIM_PROJECT }}
        run: |
          echo "Token length: ${#TESTIM_TOKEN}"
          echo "Project length: ${#TESTIM_PROJECT}"
          testim \
            --token "$TESTIM_TOKEN" \
            --project "$TESTIM_PROJECT" \
            --grid "Testim-Grid" \
            --mode "selenium" \
            --branch "master" \
            --label "random-stuff" \
            --test-config "FHD 1920x1080" \
            --parallel 3 \
            --report-file "testim-report.json"
